<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DuckMini ‚Äì Dark Mode</title>
<style>
  :root {
    --bg: #121212;
    --fg: #e0e0e0;
    --accent: #1a73e8;
    --border: #333;
  }
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: var(--bg); color: var(--fg);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    overflow: hidden;
  }
  header {
    display: flex; align-items: center; gap: 8px;
    padding: 8px; background: var(--bg); color: var(--fg);
    border-bottom: 1px solid var(--border);
    height: 56px; box-sizing: border-box;
  }
  button {
    border: 0; background: transparent; padding: 6px;
    border-radius: 6px; cursor: pointer; color: var(--fg);
  }
  input[type="search"] {
    flex: 1; padding: 6px 8px;
    border-radius: 8px; border: 1px solid var(--border);
    font-size: 14px; background: #1e1e1e; color: var(--fg);
  }
  #frameWrap {
    position: fixed; top: 56px; bottom: 0; left: 0; right: 0;
    background: black;
  }
  iframe {
    width: 100%; height: 100%; border: 0;
    background: black;
  }
  .settings {
    position: absolute; top: 56px; left: 0; right: 0;
    background: #1e1e1e; border-bottom: 1px solid var(--border);
    display: none; flex-wrap: wrap; gap: 8px; padding: 8px;
    z-index: 1000; color: var(--fg);
  }
  label { font-size: 12px; display: flex; flex-direction: column; }
  select {
    font-size: 12px; padding: 4px;
    border-radius: 4px; border: 1px solid var(--border);
    background: #121212; color: var(--fg);
  }
</style>
</head>
<body>
<header>
  <button id="back">‚óÄ</button>
  <button id="forward">‚ñ∂</button>
  <input id="q" type="search" placeholder="DuckDuckGo durchsuchen‚Ä¶" />
  <button id="searchBtn">üîç</button>
  <button id="settingsBtn">‚öôÔ∏è</button>
</header>

<div id="settingsPanel" class="settings">
  <label>Sprache/Region
    <select id="lang">
      <option value="">Standard</option>
      <option value="de-de">Deutsch</option>
      <option value="en-us">Englisch (US)</option>
    </select>
  </label>
  <label>Dark Mode
    <select id="darkMode">
      <option value="">Standard</option>
      <option value="1" selected>An</option>
      <option value="-1">Aus</option>
    </select>
  </label>
  <label>SafeSearch
    <select id="safeSearch">
      <option value="">Standard</option>
      <option value="1">Moderat</option>
      <option value="-1">Aus</option>
    </select>
  </label>
</div>

<div id="frameWrap">
  <iframe id="pane" srcdoc="<p style='padding:20px;color:white;font-family:sans-serif'>Starte eine Suche‚Ä¶</p>"></iframe>
</div>

<script>
const prefs = { lang: '', darkMode: '1', safeSearch: '' };
const q = document.getElementById('q');
const pane = document.getElementById('pane');
const settingsPanel = document.getElementById('settingsPanel');

// Felder referenzieren
const fields = {
  lang: document.getElementById('lang'),
  darkMode: document.getElementById('darkMode'),
  safeSearch: document.getElementById('safeSearch')
};

// Laden gespeicherter Einstellungen
try {
  const saved = JSON.parse(localStorage.getItem('duckmini_prefs')||'{}');
  Object.assign(prefs, saved);
} catch(e){}

for (const key in fields) {
  fields[key].value = prefs[key] || '';
  fields[key].addEventListener('change', ()=>{
    prefs[key] = fields[key].value;
    localStorage.setItem('duckmini_prefs', JSON.stringify(prefs));
  });
}

function ddgUrl(query) {
  const qenc = encodeURIComponent(query || '');
  let url = `https://duckduckgo.com/?q=${qenc}&t=hm`;
  if (prefs.lang) url += `&kl=${prefs.lang}`;
  if (prefs.darkMode) url += `&k1=${prefs.darkMode}`;
  if (prefs.safeSearch) url += `&kp=${prefs.safeSearch}`;
  return url;
}

function doSearch(query) {
  if (!query) return;
  const url = ddgUrl(query);

  // Test: iframe laden oder Tab √∂ffnen
  try {
    pane.src = url;
    setTimeout(() => {
      if (pane.contentDocument && pane.contentDocument.body && pane.contentDocument.body.innerHTML.trim() === '') {
        window.open(url, '_blank');
      }
    }, 1500);
  } catch(e) {
    window.open(url, '_blank');
  }
}

document.getElementById('searchBtn').addEventListener('click', ()=>doSearch(q.value));
q.addEventListener('keydown', (e)=>{
  if (e.key==='Enter'){ e.preventDefault(); doSearch(q.value); }
});

document.getElementById('settingsBtn').addEventListener('click', ()=>{
  if (getComputedStyle(settingsPanel).display === 'none') {
    settingsPanel.style.display = 'flex';
  } else {
    settingsPanel.style.display = 'none';
  }
});

document.getElementById('back').addEventListener('click', ()=>pane.contentWindow.history.back());
document.getElementById('forward').addEventListener('click', ()=>pane.contentWindow.history.forward());
</script>
</body>
</html>

