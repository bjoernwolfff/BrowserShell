<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DuckMini ‚Äì Vollparameter</title>
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- iOS PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="DuckMini" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />

  <style>
    :root {
      --bg: #f7f7f8;
      --accent: #1a73e8;
    }
    html, body {
      margin: 0;
      padding: 0;
      height: calc(var(--vh, 1vh) * 100);
      background: var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      overflow: hidden;
    }
    header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: var(--bg);
      box-shadow: 0 1px 0 rgba(0,0,0,0.06);
      height: 56px;
      box-sizing: border-box;
    }
    button {
      border: 0;
      background: transparent;
      padding: 6px;
      border-radius: 6px;
    }
    .btn {
      cursor: pointer;
    }
    input[type="search"], select, input[type="number"] {
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 14px;
    }
    .controls {
      display: flex;
      gap: 6px;
      width: 100%;
      align-items: center;
    }
    #frameWrap {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      top: 56px;
      background: white;
      height: calc(var(--vh, 1vh) * 100 - 56px);
    }
    iframe {
      width: 100%;
      height: 100%;
      border: 0;
      background: white;
    }
    .settings {
      padding: 10px;
      background: #fff;
      border-top: 1px solid #eee;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    label {
      font-size: 13px;
      display: flex;
      flex-direction: column;
    }
    small.gray, span.gray {
      color: #666;
      font-size: 12px;
    }
  </style>
</head>
<body>
<header>
  <button id="back">‚óÄ</button>
  <button id="forward">‚ñ∂</button>
  <input id="q" type="search" placeholder="DuckDuckGo durchsuchen‚Ä¶" />
  <button id="searchBtn">üîç</button>
  <button id="settingsBtn">‚öôÔ∏è</button>
</header>

<div id="settingsPanel" class="settings">
  <!-- DuckDuckGo Parameter -->
  <label>Sprache/Region
    <select id="lang">
      <option value="">Standard</option>
      <option value="de-de">Deutsch</option>
      <option value="en-us">Englisch (US)</option>
      <option value="fr-fr">Franz√∂sisch</option>
      <option value="es-es">Spanisch</option>
      <option value="it-it">Italienisch</option>
      <option value="nl-nl">Niederl√§ndisch</option>
    </select>
  </label>
  <label>Dark Mode
    <select id="darkMode">
      <option value="">Standard</option>
      <option value="1">An</option>
      <option value="-1">Aus</option>
    </select>
  </label>
  <label>SafeSearch
    <select id="safeSearch">
      <option value="">Standard</option>
      <option value="1">Moderat</option>
      <option value="-1">Aus</option>
    </select>
  </label>
  <label>Autovervollst√§ndigung
    <select id="autoComplete">
      <option value="">Standard</option>
      <option value="1">An</option>
      <option value="-1">Aus</option>
    </select>
  </label>
  <label>Suchvorschl√§ge
    <select id="suggestions">
      <option value="">Standard</option>
      <option value="1">An</option>
      <option value="-1">Aus</option>
    </select>
  </label>
  <label>Ergebnissprache
    <select id="resultLang">
      <option value="">Standard</option>
      <option value="de-de">Deutsch</option>
      <option value="en-us">Englisch</option>
      <option value="fr-fr">Franz√∂sisch</option>
    </select>
  </label>
  <label>Layout
    <select id="layout">
      <option value="">Standard</option>
      <option value="d">Desktop</option>
      <option value="h">High Contrast</option>
      <option value="m">Mobile</option>
    </select>
  </label>
  <label>Neuer Tab
    <select id="newTab">
      <option value="">Standard</option>
      <option value="1">Ja</option>
      <option value="-1">Nein</option>
    </select>
  </label>
  <label>HTTPS only
    <select id="httpsOnly">
      <option value="">Standard</option>
      <option value="1">Ja</option>
      <option value="-1">Nein</option>
    </select>
  </label>
</div>

<div id="frameWrap">
  <iframe id="pane" srcdoc="<p style='padding:20px;font-family:sans-serif'>Starte eine Suche‚Ä¶</p>"></iframe>
</div>

<script>
const prefs = {
  lang: '', darkMode: '', safeSearch: '',
  autoComplete: '', suggestions: '',
  resultLang: '', layout: '', newTab: '',
  httpsOnly: ''
};

const q = document.getElementById('q');
const pane = document.getElementById('pane');
const settingsBtn = document.getElementById('settingsBtn');
const settingsPanel = document.getElementById('settingsPanel');

// Felder
const langEl = document.getElementById('lang');
const darkModeEl = document.getElementById('darkMode');
const safeSearchEl = document.getElementById('safeSearch');
const autoCompleteEl = document.getElementById('autoComplete');
const suggestionsEl = document.getElementById('suggestions');
const resultLangEl = document.getElementById('resultLang');
const layoutEl = document.getElementById('layout');
const newTabEl = document.getElementById('newTab');
const httpsOnlyEl = document.getElementById('httpsOnly');

// Laden
try {
  const saved = JSON.parse(localStorage.getItem('duckmini_prefs')||'{}');
  Object.assign(prefs, saved);
} catch(e){}

langEl.value = prefs.lang;
darkModeEl.value = prefs.darkMode;
safeSearchEl.value = prefs.safeSearch;
autoCompleteEl.value = prefs.autoComplete;
suggestionsEl.value = prefs.suggestions;
resultLangEl.value = prefs.resultLang;
layoutEl.value = prefs.layout;
newTabEl.value = prefs.newTab;
httpsOnlyEl.value = prefs.httpsOnly;

[langEl,darkModeEl,safeSearchEl,autoCompleteEl,suggestionsEl,
 resultLangEl,layoutEl,newTabEl,httpsOnlyEl].forEach(el=>{
  el.addEventListener('change',()=>{
    prefs.lang = langEl.value;
    prefs.darkMode = darkModeEl.value;
    prefs.safeSearch = safeSearchEl.value;
    prefs.autoComplete = autoCompleteEl.value;
    prefs.suggestions = suggestionsEl.value;
    prefs.resultLang = resultLangEl.value;
    prefs.layout = layoutEl.value;
    prefs.newTab = newTabEl.value;
    prefs.httpsOnly = httpsOnlyEl.value;
    localStorage.setItem('duckmini_prefs', JSON.stringify(prefs));
  });
});

function ddgUrl(query) {
  const qenc = encodeURIComponent(query || '');
  let url = `https://duckduckgo.com/?q=${qenc}&t=hm`;
  if (prefs.lang) url += `&kl=${prefs.lang}`;
  if (prefs.darkMode) url += `&k1=${prefs.darkMode}`;
  if (prefs.safeSearch) url += `&kp=${prefs.safeSearch}`;
  if (prefs.autoComplete) url += `&kaf=${prefs.autoComplete}`;
  if (prefs.suggestions) url += `&kaj=${prefs.suggestions}`;
  if (prefs.resultLang) url += `&kae=${prefs.resultLang}`;
  if (prefs.layout) url += `&kaa=${prefs.layout}`;
  if (prefs.newTab) url += `&kn=${prefs.newTab}`;
  if (prefs.httpsOnly) url += `&kh=${prefs.httpsOnly}`;
  return url;
}

function doSearch(query) {
  if (!query) return;
  pane.src = ddgUrl(query);
}

document.getElementById('searchBtn').addEventListener('click', ()=>doSearch(q.value));
q.addEventListener('keydown', (e)=>{ if (e.key==='Enter'){ e.preventDefault(); doSearch(q.value); } });

settingsBtn.addEventListener('click', ()=>{
  settingsPanel.style.display = settingsPanel.style.display==='none' ? 'flex' : 'none';
});

document.getElementById('back').addEventListener('click', ()=>pane.contentWindow.history.back());
document.getElementById('forward').addEventListener('click', ()=>pane.contentWindow.history.forward());
</script>
</body>
</html>
